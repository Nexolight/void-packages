# Template file for 'medusa'
pkgname=medusa
version=0.4.3
revision=1
build_style=cmake
configure_args="
	-DMEDUSA_BUILD_WITH_OGDF=ON
	-DOGDF_PATH=${XBPS_CROSS_BASE}/usr/include/ogdf
	-DBOOST_ROOT=${XBPS_CROSS_BASE}/usr"
hostmakedepends="doxygen"
makedepends="qt5-devel libogdf-devel boost-python boost-devel"
depends="qt5 libogdf"
short_desc="An open source interactive disassembler"
maintainer="nexolight <snow.dream.ch@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://github.com/wisk/medusa"
distfiles="https://github.com/wisk/${pkgname}/archive/${version}.tar.gz"
checksum=04e17f7ad3b1e55d08f95489aa0619c67ff81f9232590ea84ebff70d0b720d71

pre_configure() {

	#bugfix required because of new cmake version
	sed -i 's|Boost 1.46|Boost|' CMakeLists.txt
	sed -i 's|Boost 1.46 COMPONENTS python|Boost COMPONENTS python27|' ./src/ui/CMakeLists.txt

	#please revisit on version change - guess there will be bugfixes
	sed -i '1s|^|#include <boost/format.hpp>\n|' ./src/core/medusa.cpp
	sed -i '2s|.*#|#|' ./src/core/medusa.cpp

	sed -i '1s|^|#include <boost/format.hpp>\n|' ./src/arch/arm/arm_architecture.cpp

	sed -i '1s|^|#include <boost/format.hpp>\n|' ./src/ui/dummy/main.cpp

	sed -i '1s|^|#include <boost/format.hpp>\n|' ./src/os/windows/stack_analyzer.cpp
	sed -i '2s|.*#|#|' ./src/os/windows/stack_analyzer.cpp
}

do_install() {
	cd build/bin
	chmod 644 *.so
	vmkdir /usr/lib/medusa
	vmkdir /usr/bin
	vcopy * /usr/lib/medusa/
	vcopy "${FILESDIR}/medusa_dummy" /usr/bin/
	vcopy "${FILESDIR}/medusa_text" /usr/bin/
	vcopy "${FILESDIR}/qMedusa" /usr/bin/
	vcopy "${FILESDIR}/semantic" /usr/bin/
}
