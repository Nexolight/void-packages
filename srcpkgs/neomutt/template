# Template file for 'neomutt'
pkgname=neomutt
version=20171013
revision=1
wrksrc="${pkgname}-${pkgname}-${version}"
build_style=gnu-configure
configure_script=./configure.autosetup
configure_args="--ssl --gpgme --notmuch --gdbm --lua --sasl"
hostmakedepends="libxslt docbook-xsl w3m"
makedepends="ncurses-devel gpgme-devel libidn-devel libressl-devel libsasl-devel
 gdbm-devel aspell-devel libnotmuch-devel gettext-devel lua-devel"
depends="mime-types"
conf_files="/etc/neomuttrc"
short_desc="Mutt with misc fixes and feature patches"
maintainer="Toyam Cox <Vaelatern@voidlinux.eu>"
license="GPL-2"
homepage="http://www.neomutt.org"
distfiles="https://github.com/neomutt/neomutt/archive/neomutt-${version}.tar.gz"
checksum=5a7c6302d623b620db03d923a7cd7cf967123a67fc42c117a0dd4b45612e9a55

case "${XBPS_TARGET_MACHINE}" in
	x86_64-musl) CFLAGS="-D_FILE_OFFSET_BITS=64 -DLARGEFILE_SOURCE=1";;
	# Inquiry: Do we have largefile support on everywhere?
esac

post_install() {
	# provided by mime-types
	rm "${DESTDIR}"/etc/${pkgname}/mime.*
	ln -s /etc/mime.types "${DESTDIR}/etc/${pkgname}/mime.types"
	# move dist to examples dir
	vsconf contrib/gpg.rc Muttrc.gpg.dist
	mv "${DESTDIR}/etc/$pkgname/Muttrc.dist" "${DESTDIR}/usr/share/examples/${pkgname}"
}

# REMARKS:
# Conf file is in a --sysconfdir=/etc/$pkgname/Muttrc and then alternatives to
# /etc/Muttrc. In addition, a dependency on mime-types is broken by having
# /etc/dir/ because mutt probably expects the mime information in the same
# dir as sysconfdir. Thus a symlink is created to deal with this.
# /etc/Muttrc is not currently in alternatives to prevent inadvertently
# overwriting configuration.
# In version 20160808 keybase integration was added, and lots of new
# documentation now gets installed. Rumors of an /etc/NeoMuttrc are in the
# release notes but not currently installed for unknown reasons.
# As of 20171013, neomutt has hard forked and no longer refers to itself as
# "Mutt" anywhere in the codebase. https://www.neomutt.org/2017/10/13/release
# /etc/neomuttrc now exists, and there are no conflicts with regular mutt.
# Due to this, an install.msg was added and all alternatives were removed.
