# Template file for 'wireguard'
pkgname=wireguard
version=0.0.20170115
revision=1
wrksrc="WireGuard-${version}"
build_wrksrc="src/tools"
build_style=gnu-makefile
make_install_args="WITH_BASHCOMPLETION=yes WITH_WGQUICK=yes"
makedepends="libmnl-devel"
depends="dkms"
short_desc="Fast, modern, secure VPN tunnel"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="GPL-2"
homepage="https://www.wireguard.io/"
distfiles="https://git.zx2c4.com/WireGuard/snapshot/WireGuard-${version}.tar.xz"
checksum=7e5f9f4699a2d4ace90d0df5d81bf0f67205ee08c45b95e0acc379bedef5ffe8

triggers="dkms"
dkms_modules="wireguard ${version}"

post_extract() {
	sed -i 's/^CFLAGS /override &/' ${build_wrksrc}/Makefile
}

post_install() {
	cd ${wrksrc}/src

	vmkdir usr/src/wireguard-${version}
	cp -a Kbuild Kconfig Makefile *.c *.h crypto selftest \
		${DESTDIR}/usr/src/wireguard-${version}

	cat >${DESTDIR}/usr/src/wireguard-${version}/dkms.conf <<EOF
PACKAGE_NAME="$pkgname"
PACKAGE_VERSION=$version
AUTOINSTALL=yes
BUILT_MODULE_NAME="$pkgname"
DEST_MODULE_LOCATION="/kernel/net"
EOF
}
